#!/bin/bash
jupyter serverextension enable --py nbserverproxy --sys-prefix
jupyter labextension install @jupyter-widgets/jupyterlab-manager \
                             @jupyterlab/hub-extension \
                             @pyviz/jupyterlab_pyviz \
                             dask-labextension

export DASK_KUBERNETES__WORKER_TEMPLATE_PATH=/home/jovyan/.dask/config.yaml
export DASK_KUBERNETES__WORKER_NAME=dask-{JUPYTERHUB_USER}-{uuid}


# set worker image url in worker template
if [[ -z "${JUPYTER_IMAGE_SPEC}" ]]; then
    echo "JUPYTER_IMAGE_SPEC is not set"
else
  sed -i -e "s|WORKER_IMAGE|${JUPYTER_IMAGE_SPEC}|g" ${DASK_KUBERNETES__WORKER_TEMPLATE_PATH}
fi

exec "$@"

#EOF
